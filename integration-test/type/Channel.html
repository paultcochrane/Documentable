<!doctype html>
<html lang="en">
<head>
    <title>class Channel</title>
    <meta charset="UTF-8"/>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="icon" href="/Documentable/integration-test/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="/Documentable/integration-test/css/app.css" media="screen" title="default" />
    <noscript> <style> #search { visibility: hidden; } </style> </noscript>
</head>

<body class="pod">

    <div id="___top"></div>

    <div id="header" class="pretty-box green">

        <a href="/Documentable/integration-test/">
            <img src="/Documentable/integration-test/images/Camelia.svg"alt="»ö«"id="logo"width="62"height="48"/> &nbsp;Raku Documentation
        </a>

        <div id="search" class="ui-widget">
            <div class="green">
                <input placeholder="Loading..." id="query" accesskey="f" title="Enter term to search for (hit Esc to focus)"/>
            </div>
            <p id="not-found-message">
                Not in Index (<a href="" id="try-web-search">try site search</a>)
            </p>
        </div>
        
        <div class="menu">
            
            <div class="menu-items dark-green">
                <a class='menu-item darker-green' href='https://raku.org'><strong>Raku homepage</strong></a>
                    <a class="menu-item " href="/Documentable/integration-test/language.html"> Language </a>
                    <a class="menu-item selected darker-green" href="/Documentable/integration-test/type.html"> Types </a>
                    <a class="menu-item " href="/Documentable/integration-test/routine.html"> Routines </a>
                    <a class="menu-item " href="https://webchat.freenode.net/?channels=#raku"> Chat with us </a>
            </div>
            
            <div class="menu-items darker-green"><div class="menu-items darker-green"><div class="menu-items darker-green"><div class="menu-items darker-green">
                    <a class="menu-item" href="/Documentable/integration-test/type.html"> All </a>
                    <a class="menu-item" href="/Documentable/integration-test/type-basic.html"> Basic </a>
                    <a class="menu-item" href="/Documentable/integration-test/type-html-generation.html"> HTML Generation </a>
                    <a class="menu-item" href="/Documentable/integration-test/type-exception.html"> Exceptions </a>
            </div></div></div></div>
        
        </div>
    </div>

    <div id="content" class="pretty-box yellow content_fragment">

        <div align="right" style="display:;">
            <button title="Edit this page"  class="pencil" onclick="location='https://github.com/Raku/doc/tree/master/docs/Type/Channel.pod6'">
                <svg width="14px" height="16px" viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <defs></defs>
                    <g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="pencil" fill="#000000">
                            <path d="M0,12 L0,15 L3,15 L11,7 L8,4 L0,12 L0,12 Z M3,14 L1,14 L1,12 L2,12 L2,13 L3,13 L3,14 L3,14 Z M13.3,4.7 L12,6 L9,3 L10.3,1.7 C10.69,1.31 11.32,1.31 11.71,1.7 L13.3,3.29 C13.69,3.68 13.69,4.31 13.3,4.7 L13.3,4.7 Z" id="Shape"></path>
                        </g>
                    </g>
                </svg>
            </button>
        </div>

        <h1 class="title">class Channel</h1>
        <p class="subtitle">Thread-safe queue for sending values from producers to consumers</p>

        <nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
           <tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="#Methods">Methods</a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.1</td><td class="toc-text"><a href="#method_send">method send</a></td></tr>
           <tr class="toc-level-2"><td class="toc-number">1.2</td><td class="toc-text"><a href="#method_receive">method receive</a></td></tr>
                      <tr class="toc-level-2"><td class="toc-number">1.3</td><td class="toc-text"><a href="#method_poll">method poll</a></td></tr>
          <tr class="toc-level-2"><td class="toc-number">1.4</td><td class="toc-text"><a href="#method_close">method close</a></td></tr>
                                       <tr class="toc-level-2"><td class="toc-number">1.5</td><td class="toc-text"><a href="#method_list">method list</a></td></tr>
         <tr class="toc-level-2"><td class="toc-number">1.6</td><td class="toc-text"><a href="#method_closed">method closed</a></td></tr>
       <tr class="toc-level-2"><td class="toc-number">1.7</td><td class="toc-text"><a href="#method_fail">method fail</a></td></tr>
             <tr class="toc-level-2"><td class="toc-number">1.8</td><td class="toc-text"><a href="#method_Capture">method Capture</a></td></tr>
      <tr class="toc-level-2"><td class="toc-number">1.9</td><td class="toc-text"><a href="#method_Supply">method Supply</a></td></tr>
                <tr class="toc-level-2"><td class="toc-number">1.10</td><td class="toc-text"><a href="#sub_await">sub await</a></td></tr>
          <tr class="toc-level-1"><td class="toc-number">2</td><td class="toc-text"><a href="#Type_Graph">Type Graph</a></td></tr>
 
</table>
</nav>

        <div class="pod-body ">
            <pre class="pod-block-code">class Channel {}</pre>
<p>A <code>Channel</code> is a thread-safe queue that helps you to send a series of objects from one or more producers to one or more consumers. Each object will arrive at only one such consumer, selected by the scheduler. If there is only one consumer and one producer, the order of objects is guaranteed to be preserved. Sending on a <code>Channel</code> is non-blocking.</p>
<pre class="pod-block-code">my $c = Channel.new;
await (^10).map: {
    start {
        my $r = rand;
        sleep $r;
        $c.send($r);
    }
}
$c.close;
say $c.list;</pre>
<p>Further examples can be found in the <a href="/Documentable/integration-test/language/concurrency#Channels">concurrency page</a></p>
<h1 id="Methods"><a class="u" href="#___top" title="go to top of document">Methods</a></h1>
<h2 id="method_send"><a class="u" href="#___top" title="go to top of document">method send</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method send(Channel:D: \item)</pre>
<p>Enqueues an item into the <code>Channel</code>. Throws an exception of type <a href="/Documentable/integration-test/type/X::Channel::SendOnClosed">X::Channel::SendOnClosed</a> if the channel has been closed already. This call will <strong>not</strong> block waiting for a consumer to take the object. There is no set limit on the number of items that may be queued, so care should be taken to prevent runaway queueing.</p>
<pre class="pod-block-code">my $c = Channel.new;
$c.send(1);
$c.send([2, 3, 4, 5]);
$c.close;
say $c.list; # OUTPUT: «(1 [2 3 4 5])␤»</pre>
<h2 id="method_receive"><a class="u" href="#___top" title="go to top of document">method receive</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method receive(Channel:D:)</pre>
<p>Receives and removes an item from the channel. It blocks if no item is present, waiting for a <code>send</code> from another thread.</p>
<p>Throws an exception of type <a href="/Documentable/integration-test/type/X::Channel::ReceiveOnClosed">X::Channel::ReceiveOnClosed</a> if the channel has been closed, and the last item has been removed already, or if <code>close</code> is called while <code>receive</code> is waiting for an item to arrive.</p>
<p>If the channel has been marked as erratic with method <code>fail</code>, and the last item has been removed, throws the argument that was given to <code>fail</code> as an exception.</p>
<p>See method <code>poll</code> for a non-blocking version that won&#39;t throw exceptions.</p>
<pre class="pod-block-code">my $c = Channel.new;
$c.send(1);
say $c.receive; # OUTPUT: «1␤»</pre>
<h2 id="method_poll"><a class="u" href="#___top" title="go to top of document">method poll</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method poll(Channel:D:)</pre>
<p>Receives and removes an item from the channel. If no item is present, returns <code>Nil</code> instead of waiting.</p>
<pre class="pod-block-code">my $c = Channel.new;
Promise.in(2).then: { $c.close; }
^10 .map({ $c.send($_); });
loop {
    if $c.poll -&gt; $item { $item.say };
    if $c.closed  { last };
    sleep 0.1;
}</pre>
<p>See method <code>receive</code> for a blocking version that properly responds to channel closing and failure.</p>
<h2 id="method_close"><a class="u" href="#___top" title="go to top of document">method close</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method close(Channel:D:)</pre>
<p>Close the <code>Channel</code>, normally. This makes subsequent <code>send</code> calls die with <a href="/Documentable/integration-test/type/X::Channel::SendOnClosed">X::Channel::SendOnClosed</a>. Subsequent calls of <code>.receive</code> may still drain any remaining items that were previously sent, but if the queue is empty, will throw an <a href="/Documentable/integration-test/type/X::Channel::ReceiveOnClosed">X::Channel::ReceiveOnClosed</a> exception. Since you can produce a <code>Seq</code> from a Channel by contextualizing to array with <code>@()</code> or by calling the <code>.list</code> method, these methods will not terminate until the channel has been closed. A <a href="/Documentable/integration-test/language/concurrency#index-entry-whenever">whenever</a>-block will also terminate properly on a closed channel.</p>
<pre class="pod-block-code">my $c = Channel.new;
$c.close;
$c.send(1);
CATCH { default { put .^name, &#39;: &#39;, .Str } };
# OUTPUT: «X::Channel::SendOnClosed: Cannot send a message on a closed channel␤»
</pre>
<p>Please note that any exception thrown may prevent <code>.close</code> from being called, this may hang the receiving thread. Use a <a href="/Documentable/integration-test/language/phasers#LEAVE">LEAVE</a> phaser to enforce the <code>.close</code> call in this case.</p>
<h2 id="method_list"><a class="u" href="#___top" title="go to top of document">method list</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method list(Channel:D: --&gt; List:D)</pre>
<p>Returns a list based on the <code>Seq</code> which will iterate items in the queue and remove each item from it as it iterates. This can only terminate once the <code>close</code> method has been called.</p>
<pre class="pod-block-code">my $c = Channel.new; $c.send(1); $c.send(2);
$c.close;
say $c.list; # OUTPUT: «(1 2)␤»</pre>
<h2 id="method_closed"><a class="u" href="#___top" title="go to top of document">method closed</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method closed(Channel:D: --&gt; Promise:D)</pre>
<p>Returns a promise that will be kept once the channel is closed by a call to method <code>close</code>.</p>
<pre class="pod-block-code">my $c = Channel.new;
$c.closed.then({ say &quot;It&#39;s closed!&quot; });
$c.close;
sleep 1;</pre>
<h2 id="method_fail"><a class="u" href="#___top" title="go to top of document">method fail</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method fail(Channel:D: $error)</pre>
<p>Closes the <code>Channel</code> (that is, makes subsequent <code>send</code> calls die), and enqueues the error to be thrown as the final element in the channel. Method <code>receive</code> will throw that error as an exception. Does nothing if the channel has already been closed or <code>.fail</code> has already been called on it.</p>
<pre class="pod-block-code">my $c = Channel.new;
$c.fail(&quot;Bad error happens!&quot;);
$c.receive;
CATCH { default { put .^name, &#39;: &#39;, .Str } };
# OUTPUT: «X::AdHoc: Bad error happens!␤»</pre>
<h2 id="method_Capture"><a class="u" href="#___top" title="go to top of document">method Capture</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method Capture(Channel:D --&gt; Capture:D)</pre>
<p>Equivalent to calling <a href="/Documentable/integration-test/type/List#method_Capture"><code>.List.Capture</code></a> on the invocant.</p>
<h2 id="method_Supply"><a class="u" href="#___top" title="go to top of document">method Supply</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">method Supply(Channel:D:)</pre>
<p>This returns an <code>on-demand</code> <a href="/Documentable/integration-test/type/Supply">Supply</a> that emits a value for every value received on the Channel. <code>done</code> will be called on the <code>Supply</code> when the <a href="/Documentable/integration-test/type/Channel">Channel</a> is closed.</p>
<pre class="pod-block-code">my $c = Channel.new;
my Supply $s1 = $c.Supply;
my Supply $s2 = $c.Supply;
$s1.tap(-&gt; $v { say &quot;First $v&quot; });
$s2.tap(-&gt; $v { say &quot;Second $v&quot; });
^10 .map({ $c.send($_) });
sleep 1;</pre>
<p>Multiple calls to this method produce multiple instances of Supply, which compete over the values from the Channel.</p>
<h2 id="sub_await"><a class="u" href="#___top" title="go to top of document">sub await</a></h2>
<p>Defined as:</p>
<pre class="pod-block-code">multi sub await(Channel:D)
multi sub await(*@)</pre>
<p>Waits until all of one or more channels has a value available, and returns those values (it calls <code>.receive</code> on the channel). Also works with <a href="/Documentable/integration-test/type/Promise">promises</a>.</p>
<pre class="pod-block-code">my $c = Channel.new;
Promise.in(1).then({$c.send(1)});
say await $c;</pre>
<p>Since 6.d, it no longer blocks a thread while waiting.</p>
<h1 id="Type_Graph"><a class="u" href="#___top" title="go to top of document">Type Graph</a></h1>
<figure>
  <figcaption>Type relations for <code>Channel</code></figcaption>
  <svg width="98pt" height="188pt"
 viewBox="0.00 0.00 97.69 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>perl6&#45;type&#45;graph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 93.69,-184 93.69,4 -4,4"/>
<!-- Channel -->
<g id="node1" class="node">
<title>Channel</title>
<g id="a_node1"><a xlink:href="/type/Channel" xlink:title="Channel">
<ellipse fill="none" stroke="#000000" cx="44.85" cy="-18" rx="44.69" ry="18"/>
<text text-anchor="middle" x="44.85" y="-14.3" font-family="FreeSans" font-size="14.00" fill="#000000">Channel</text>
</a>
</g>
</g>
<!-- Any -->
<g id="node3" class="node">
<title>Any</title>
<g id="a_node3"><a xlink:href="/type/Any" xlink:title="Any">
<ellipse fill="none" stroke="#000000" cx="44.85" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="44.85" y="-86.3" font-family="FreeSans" font-size="14.00" fill="#000000">Any</text>
</a>
</g>
</g>
<!-- Channel&#45;&gt;Any -->
<g id="edge1" class="edge">
<title>Channel&#45;&gt;Any</title>
<path fill="none" stroke="#000000" d="M44.85,-36.3C44.85,-44.02 44.85,-53.29 44.85,-61.89"/>
<polygon fill="#000000" stroke="#000000" points="41.35,-61.9 44.85,-71.9 48.35,-61.9 41.35,-61.9"/>
</g>
<!-- Mu -->
<g id="node2" class="node">
<title>Mu</title>
<g id="a_node2"><a xlink:href="/type/Mu" xlink:title="Mu">
<ellipse fill="none" stroke="#000000" cx="44.85" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="44.85" y="-158.3" font-family="FreeSans" font-size="14.00" fill="#000000">Mu</text>
</a>
</g>
</g>
<!-- Any&#45;&gt;Mu -->
<g id="edge2" class="edge">
<title>Any&#45;&gt;Mu</title>
<path fill="none" stroke="#000000" d="M44.85,-108.3C44.85,-116.02 44.85,-125.29 44.85,-133.89"/>
<polygon fill="#000000" stroke="#000000" points="41.35,-133.9 44.85,-143.9 48.35,-133.9 41.35,-133.9"/>
</g>
</g>
</svg>

  <p class="fallback">
    <a
      rel="alternate"
      href="/images/type-graph-Channel.svg"
      type="image/svg+xml"
      >Expand above chart</a
    >
  </p>
</figure>

        </div>
    </div>

    

    <footer class="pretty-box yellow">
        <p>
            Generated from <a href="https://github.com/Raku/doc/tree/master/docs/Type/Channel.pod6">https://github.com/Raku/doc/tree/master/docs/Type/Channel.pod6</a>.
        </p>
        <p>
            This is a work in progress to document Raku (formerly known as Perl 6), and
            known to be incomplete.
        </p>
        <p>
            <a href="https://github.com/raku/doc/blob/master/CONTRIBUTING.md#reporting-bugs">
                Please report any issues
            </a>
            Your contribution is appreciated.
        </p>
        <p>
            This documentation is provided under the terms of the
            <a href="https://raw.githubusercontent.com/raku/doc/master/LICENSE">
                Artistic License 2.0
            </a>. The Camelia image is
            <a href="https://raw.githubusercontent.com/raku/mu/master/misc/camelia.txt">
                copyright © 2009 by Larry Wall.
            </a>
            <!-- CREDITS -->
            <!--External Link Image by Zapyon, CCA-SA 4.0. Derived from Wikimedia Foundation https://commons.wikimedia.org/wiki/File:External-link-04-bold-12x12.svg -->
        </p>
    </footer>

    <script type="text/javascript" src="/Documentable/integration-test/js/app.js?v=1"></script>
    <script type="text/javascript" src="/Documentable/integration-test/js/search.js?v=3"></script>
</body>
</html>

