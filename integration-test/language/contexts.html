<!doctype html>
<html lang="en">
<head>
    <title>Contexts and contextualizers</title>
    <meta charset="UTF-8"/>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="icon" href="/Documentable/integration-test/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="/Documentable/integration-test/css/app.css" media="screen" title="default" />
    <noscript> <style> #search { visibility: hidden; } </style> </noscript>
</head>

<body class="pod">

    <div id="___top"></div>

    <div id="header" class="pretty-box green">

        <a href="/Documentable/integration-test/">
            <img src="/Documentable/integration-test/images/Camelia.svg"alt="»ö«"id="logo"width="62"height="48"/> &nbsp;Raku Documentation
        </a>

        <div id="search" class="ui-widget">
            <div class="green">
                <input placeholder="Loading..." id="query" accesskey="f" title="Enter term to search for (hit Esc to focus)"/>
            </div>
            <p id="not-found-message">
                Not in Index (<a href="" id="try-web-search">try site search</a>)
            </p>
        </div>
        
        <div class="menu">
            
            <div class="menu-items dark-green">
                <a class='menu-item darker-green' href='https://raku.org'><strong>Raku homepage</strong></a>
                    <a class="menu-item selected darker-green" href="/Documentable/integration-test/language.html"> Language </a>
                    <a class="menu-item " href="/Documentable/integration-test/type.html"> Types </a>
                    <a class="menu-item " href="/Documentable/integration-test/routine.html"> Routines </a>
                    <a class="menu-item " href="https://webchat.freenode.net/?channels=#raku"> Chat with us </a>
            </div>
            
            
            
        
        </div>
    </div>

    <div id="content" class="pretty-box yellow content_fragment">

        <div align="right" style="display:;">
            <button title="Edit this page"  class="pencil" onclick="location='https://github.com/Raku/doc/tree/master/docs/Language/contexts.pod6'">
                <svg width="14px" height="16px" viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <defs></defs>
                    <g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="pencil" fill="#000000">
                            <path d="M0,12 L0,15 L3,15 L11,7 L8,4 L0,12 L0,12 Z M3,14 L1,14 L1,12 L2,12 L2,13 L3,13 L3,14 L3,14 Z M13.3,4.7 L12,6 L9,3 L10.3,1.7 C10.69,1.31 11.32,1.31 11.71,1.7 L13.3,3.29 C13.69,3.68 13.69,4.31 13.3,4.7 L13.3,4.7 Z" id="Shape"></path>
                        </g>
                    </g>
                </svg>
            </button>
        </div>

        <h1 class="title">Contexts and contextualizers</h1>
        <p class="subtitle">What are contexts and how to switch into them</p>

        <nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
   <tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="#Sink">Sink </a></td></tr>
                                                   <tr class="toc-level-1"><td class="toc-number">2</td><td class="toc-text"><a href="#Number">Number </a></td></tr>
                                                         <tr class="toc-level-1"><td class="toc-number">3</td><td class="toc-text"><a href="#String">String </a></td></tr>
                                                                   <tr class="toc-level-1"><td class="toc-number">4</td><td class="toc-text"><a href="#Boolean">Boolean </a></td></tr>
                                 <tr class="toc-level-1"><td class="toc-number">5</td><td class="toc-text"><a href="#List">List </a></td></tr>
              <tr class="toc-level-1"><td class="toc-number">6</td><td class="toc-text"><a href="#Item_context">Item context</a></td></tr>
                                      
</table>
</nav>

        <div class="pod-body ">
            <p>A context is needed, in many occasions, to interpret the value of a container. In Raku, we will use context to coerce the value of a container into some type or class, or in general decide what to do with it, as in the case of the sink context. In general, recognizing an object that is in a certain context will force an implicit coercion by calling a specific method on it.</p>
<h1 id="Sink"><a class="u" href="#___top" title="go to top of document">Sink <a name="Documentable/integration-test/index-entry-sink_context"></a></a></h1>
<p>The <em>sink</em> context is equivalent to what in other languages is called <code>void</code> context, that is, a context in which we throw (down the sink, as it were) the result of an operation or the return value from a block. In general, this context will be invoked in warnings and errors when a statement does not know what to do with that value.</p>
<pre class="pod-block-code">my $sub = -&gt; $a { return $a² };
$sub; # OUTPUT: «WARNINGS:␤Useless use of $sub in sink context (line 1)␤»
</pre>
<p><a name="Documentable/integration-test/index-entry-sinking"></a> You can force that sink context on <a href="/Documentable/integration-test/type/Iterator">Iterator</a>s, by using the <a href="/Documentable/integration-test/routine/sink-all"><code>sink-all</code></a> method. <a href="/Documentable/integration-test/type/Proc">Proc</a>s can also be <a href="/Documentable/integration-test/type/Proc#method_sink">sunk via the <code>sink</code> method</a>, forcing them to raise an exception and not returning anything.</p>
<p>In general, blocks will warn if evaluated in sink context; however, <a href="/Documentable/integration-test/language/control#F#gather/take">gather/take blocks</a> are explicitly evaluated in sink context, with values returned explicitly using <code>take</code>:</p>
<pre class="pod-block-code">my @results = gather for 1..1 { ^10 .map: *.take };
say @results; # OUTPUT: «[0 1 2 3 4 5 6 7 8 9]␤»
</pre>
<p>In this example, <code>for</code> is run in sunk context, and within it, <code>map</code> is too. Results are taken explicitly from the loop via gather/take.</p>
<p>In sink context, an object will call its <code>sink</code> method if present:</p>
<pre class="pod-block-code">sub foo {
    return [&lt;a b c&gt;] does role {
        method sink { say &quot;sink called&quot; }
    }
}
foo; # OUTPUT: sink called
</pre>
<h1 id="Number"><a class="u" href="#___top" title="go to top of document">Number <a name="Documentable/integration-test/index-entry-number_context"></a></a></h1>
<p>This context, and probably all other contexts except <em>sink</em> above, are <em>conversion</em> or <em>interpretation</em> contexts in the sense that they take an untyped or typed variable and duck-type it to whatever is needed to perform the operation. In some cases that will imply a conversion (from <a href="/Documentable/integration-test/type/Str">Str</a> to <a href="/Documentable/integration-test/type/Numeric">Numeric</a>, for instance); in other cases simply an interpretation (<a href="/Documentable/integration-test/type/IntStr">IntStr</a> will be interpreted as <a href="/Documentable/integration-test/type/Int">Int</a> or as <a href="/Documentable/integration-test/type/Str">Str</a>).</p>
<p><em>Number context</em> is called whenever we need to apply a numerical operation on a variable.</p>
<pre class="pod-block-code">my $stringone = &quot;1                 &quot;;
my $stringthree = &quot;3                        &quot;;
say $stringone + $stringthree; # OUTPUT: «4␤»
</pre>
<p>In the code above, strings will be interpreted in numeric context as long as there are only a few digits and no other characters. It can have any number of leading or trailing whitespace, however.</p>
<p>Numeric context can be forced by using arithmetic operators such as <code>+</code> or <code>-</code>. In that context, the <a href="/Documentable/integration-test/routine/Numeric"><code>Numeric</code></a> method will be called if available and the value returned used as the numeric value of the object.</p>
<pre class="pod-block-code">my $t = True;
my $f = False;
say $t + $f;      # OUTPUT: «1␤»
say $t.Numeric;   # OUTPUT: «1␤»
say $f.Numeric;   # OUTPUT: «0␤»
my $list= &lt;a b c&gt;;
say True + $list; # OUTPUT: «4␤»
say +&quot;  \n &quot;;     # OUTPUT: «0␤»
</pre>
<p>Whitespace in any quantity will be converted to 0, as is shown in the last statement. In the case of <em>listy</em> things, the numeric value will be in general equivalent to <code>.elems</code>; in some cases, like <a href="/Documentable/integration-test/routine/Numeric#(Thread)_method_Numeric">Thread</a>, it will return an unique thread identifier.</p>
<h1 id="String"><a class="u" href="#___top" title="go to top of document">String <a name="Documentable/integration-test/index-entry-string_context"></a></a></h1>
<p>In a <em>string context</em>, values can be manipulated as strings. This context is used, for instance, for coercing non-string values so that they can be printed to standard output.</p>
<pre class="pod-block-code">put $very-complicated-and-hairy-object; # OUTPUT: something meaningful
</pre>
<p>Or when smartmatching to a regular expression:</p>
<pre class="pod-block-code">put 333444777 ~~ /(3+)/; # OUTPUT: «｢333｣␤ 0 =&gt; ｢333｣␤»</pre>
<p>In general, the <a href="/Documentable/integration-test/routine/Str"><code>Str</code> routine</a> will be called on a variable to contextualize it; since this method is inherited from <a href="/Documentable/integration-test/type/Mu">Mu</a>, it is always present, but it is not always guaranteed to work. In some core classes it will issue a warning.</p>
<p><a href="/Documentable/integration-test/routine/~"><code>~</code></a> is the (unary) string contextualizer. As an operator, it concatenates strings, but as a prefix operator it becomes the string context operator.</p>
<pre class="pod-block-code">my @array = [ [1,2,3], [4,5,6]];
say ~@array; # OUTPUT: «1 2 3 4 5 6␤»
</pre>
<p>This will happen also in a <a href="/Documentable/integration-test/language/operators#Reduction_operators"><em>reduction</em></a> context, when <code>[~]</code> is applied to a list</p>
<pre class="pod-block-code">say [~] [ 3, 5+6i, Set(&lt;a b c&gt;), [1,2,3] ]; # OUTPUT: «35+6ic a b1 2 3␤»</pre>
<p>In that sense, empty lists or other containers will stringify to an empty string:</p>
<pre class="pod-block-code">say [~] [] ; # OUTPUT: «␤»</pre>
<p>Since <a href="/Documentable/integration-test/routine/~#(Operators)_infix_~"><code>~</code> acts also as buffer concatenation operator</a>, it will have to check that every element is not empty, since a single empty buffer in string context will behave as a string, thus yielding an error.</p>
<pre class="pod-block-code">say [~] Buf.new(0x3,0x33), Buf.new(0x2,0x22);
# OUTPUT: «Buf:0x&lt;03 33 02 22&gt;␤»</pre>
<p>However,</p>
<pre class="pod-block-code">my $non-empty = Buf.new(0x3, 0x33);
my $empty = [];
my $non-empty-also = Buf.new(0x2,0x22);
say [~] $non-empty, $empty, $non-empty-also;
# OUTPUT: «Cannot use a Buf as a string, but you called the Stringy method on it
</pre>
<p>Since <code>~</code> is putting in string context the second element of this list, <a href="/Documentable/integration-test/routine/~#(Operators)_infix_~"><code>~</code></a> is going to be using the second form that applies to strings, thus yielding the shown error. Simply making sure that everything you concatenate is a buffer will avoid this problem.</p>
<pre class="pod-block-code">my $non-empty = Buf.new(0x3, 0x33);
my $empty = Buf.new();
my $non-empty-also = Buf.new(0x2,0x22);
say [~] $non-empty, $empty, $non-empty-also; # OUTPUT: «Buf:0x&lt;03 33 02 22&gt;␤»
</pre>
<p>In general, a context will coerce a variable to a particular type by calling the contextualizer; in the case of mixins, if the context class is mixed in, it will behave in that way.</p>
<pre class="pod-block-code">my $described-number = 1i but &#39;Unity in complex plane&#39;;
put $described-number; # OUTPUT: «Unity in complex plane␤»</pre>
<p><code>but</code> creates a mixin, which endows the complex number with a <code>Str</code> method. <code>put</code> contextualizes it into a string, that is, it calls <code>Str</code>, the string contextualizer, with the result shown above.</p>
<h1 id="Boolean"><a class="u" href="#___top" title="go to top of document">Boolean <a name="Documentable/integration-test/index-entry-Boolean_context"></a></a></h1>
<p>This context will force a variable to be interpreted as <code>True</code> or <code>False</code>.</p>
<pre class="pod-block-code">say &quot;Hey&quot; if 7;  # OUTPUT: «Hey␤»
say &quot;Ahoy&quot; if &quot;&quot;;</pre>
<p>This context appears in expressions such as <code>if</code> or <code>while</code>, and is equivalent to calling <code>so</code> on these values.</p>
<pre class="pod-block-code">say &quot;Hey&quot; if 7.so;          # OUTPUT: «Hey␤»
say &quot;Ahoy&quot; if not set().so; # OUTPUT: «Ahoy␤»
</pre>
<p>In general, non-zero, non-empty will be converted to <code>True</code>; zero or empty will be equivalent to <code>False</code>. But <code>.so</code> can be defined to return any Boolean value we want, so this is just a rule of thumb.</p>
<p><code>?</code> and <code>!</code> are the Boolean context operator and its negation respectively. They will force this context on an object.</p>
<pre class="pod-block-code">say ? 0i;    # OUTPUT: «False␤»
say ! :true; # OUTPUT: «False␤»
</pre>
<h1 id="List"><a class="u" href="#___top" title="go to top of document">List <a name="Documentable/integration-test/index-entry-list_context"></a></a></h1>
<p>There are actually several different <a href="/Documentable/integration-test/language/list#List_contexts">list contexts</a>, which are better explained in that page. In general, the list contextualizer is the comma <code>,</code></p>
<pre class="pod-block-code">say (3,).^name; # OUTPUT: «List␤»</pre>
<p>and the method called in that case is also <code>.list</code></p>
<pre class="pod-block-code">Any.list.^name;   # OUTPUT: «List␤»
say 3.list.^name; # OUTPUT: «List␤»
say (^3).list;    # OUTPUT: «(0 1 2)␤»
</pre>
<h1 id="Item_context"><a class="u" href="#___top" title="go to top of document">Item context</a></h1>
<p>Item or scalar context will deal with complex pieces of data as if they were a single item. It is forced when you try to assign to a scalar variable</p>
<pre class="pod-block-code">my $scalar-context = &lt;1 2 3&gt;;
say &quot;→ $_&quot; for $scalar-context; # OUTPUT: «→ 1 2 3␤»
</pre>
<p>It can be induced using the <code>$</code> operator, that acts as the contextualizer operator of by calling <code>item</code> as a method or routine</p>
<pre class="pod-block-code">.say for $(1,2,3);      # OUTPUT: «(1 2 3)␤»
.say for (1,2,3).item;  # OUTPUT: «(1 2 3)␤»
.say for item( 1..3 );  # OUTPUT: «1..3␤»
</pre>
<p>Itemization affects only their behavior in list context; however, they will still keep their <code>Positional</code> role or other roles they might have:</p>
<pre class="pod-block-code">$(1,2,3).elems.say;          # OUTPUT: «3␤»
say (1,2,3).item[2];         # OUTPUT: «3␤»
say $( key =&gt; &#39;value&#39;)&lt;key&gt;; # OUTPUT: «value␤»
</pre>
<p>Itemization <em>containerizes</em> values in a data structure keeping them, for instance, from being flattened into the surrounding list or data structure:</p>
<pre class="pod-block-code">.say for (1, $(2,3), 4).flat; # OUTPUT: «1␤(2 3)␤4␤»
say (1, $&lt;a b&gt;, 2).elems; # OUTPUT: «3␤»
</pre>
<p>The itemizer operator will call the <code>.item</code> method on the object; it can also be called as a subroutine. Since <a href="/Documentable/integration-test/type/Mu#method_item">that is a method inherited from <code>Mu</code></a>, objects of any class can be itemized.</p>

        </div>
    </div>

    

    <footer class="pretty-box yellow">
        <p>
            Generated from <a href="https://github.com/Raku/doc/tree/master/docs/Language/contexts.pod6">https://github.com/Raku/doc/tree/master/docs/Language/contexts.pod6</a>.
        </p>
        <p>
            This is a work in progress to document Raku (formerly known as Perl 6), and
            known to be incomplete.
        </p>
        <p>
            <a href="https://github.com/raku/doc/blob/master/CONTRIBUTING.md#reporting-bugs">
                Please report any issues
            </a>
            Your contribution is appreciated.
        </p>
        <p>
            This documentation is provided under the terms of the
            <a href="https://raw.githubusercontent.com/raku/doc/master/LICENSE">
                Artistic License 2.0
            </a>. The Camelia image is
            <a href="https://raw.githubusercontent.com/raku/mu/master/misc/camelia.txt">
                copyright © 2009 by Larry Wall.
            </a>
            <!-- CREDITS -->
            <!--External Link Image by Zapyon, CCA-SA 4.0. Derived from Wikimedia Foundation https://commons.wikimedia.org/wiki/File:External-link-04-bold-12x12.svg -->
        </p>
    </footer>

    <script type="text/javascript" src="/Documentable/integration-test/js/app.js?v=1"></script>
    <script type="text/javascript" src="/Documentable/integration-test/js/search.js?v=3"></script>
</body>
</html>

